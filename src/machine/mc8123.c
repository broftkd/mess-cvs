/***************************************************************************

NEC MC-8123 encryption emulation

Decryption tables provided by David Widel
Decryption algorithm by Nicola Salmoria

The NEC MC-8123 is a Z80 with built-in encryption.
It contains some battery-backed RAM, when the battery dies the CPU stops
working.

It was used in a few games; for now, only 317-0066 has been decrypted.

It is still not know how much the encryption can vary from one CPU to the
other. I've assumed that the encryption tables are hardcoded, and the internal
RAM only contains the code of the table to use.

Known games that use this CPU are:

  317-5012      Ganbare Chinsan Ooshoubu  NEC MC-8123A
  317-0014      DakkoChan Jansoh
  317-0029      Block Gal                 NEC MC-8123B 651
  317-0030      Perfect Billiard
  317-0042      Opa Opa
  317-0043      Wonder Boy Monster Land
  317-0054      Shinobi (sound CPU)       NEC MC-8123B 652
  317-0057      Fantasy Zone 2
  317-0064      Ufo Senshi Yohko Chan
  317-0066      Altered Beast (sound CPU)
                Ninja Kid II sound program also seems to use this encryption

***************************************************************************/

#include "driver.h"


static UINT8 data_select_0066[0x800] =
{
	0xc3,0x18,0x2d,0xa8,0xc2,0x56,0x5d,0x11,0x5f,0x0b,0x09,0x81,0x53,0xc9,0x48,0x27,
	0x10,0xcf,0x07,0xb5,0x86,0x84,0x53,0xac,0xbe,0x2b,0x10,0x64,0x5e,0x1d,0x69,0x6e,
	0x79,0xc3,0x85,0x79,0x7a,0x62,0xc4,0x54,0x4a,0xc0,0x4c,0x67,0x8e,0x04,0x13,0x0f,
	0x22,0x54,0x98,0x6a,0x8f,0x2c,0x0a,0x79,0x61,0x11,0xc5,0xbd,0x93,0x35,0x09,0x8a,
	0x87,0x1e,0xa9,0x60,0x80,0x00,0x20,0x38,0x9b,0x0f,0xbc,0x11,0x7c,0x93,0x98,0x0c,
	0x6b,0x76,0x05,0x73,0x46,0xbb,0x6c,0x7c,0x2e,0xb3,0xc2,0x45,0x98,0x9d,0x5a,0xa0,
	0x52,0x09,0x59,0xad,0x55,0xa2,0x3b,0x33,0x63,0x9c,0x27,0x4a,0xc8,0x39,0x15,0x1b,
	0xa6,0x31,0x02,0xb0,0x1b,0xa8,0x0e,0xab,0x1c,0x3a,0x28,0x2d,0xcf,0x08,0xba,0xc2,
	0x4f,0xcc,0x7d,0xc1,0x02,0xa0,0x4b,0xc3,0x85,0x3e,0x28,0x1d,0x11,0x06,0x1e,0xb7,
	0xb0,0x76,0x5e,0x2d,0x2f,0x19,0xcf,0x5b,0x6f,0x92,0x34,0x12,0xc7,0x35,0x9b,0x37,
	0x51,0x68,0x25,0x22,0x9b,0x42,0xa1,0xa7,0x0e,0xca,0x21,0x08,0xb1,0x66,0x85,0x01,
	0xa7,0x02,0x22,0x09,0x7c,0x94,0x25,0x9e,0x43,0xb6,0x4c,0x28,0x0a,0x3e,0x06,0x68,
	0x96,0x1c,0x0b,0x7b,0x90,0x15,0x62,0x07,0xb8,0x45,0x4b,0x0f,0x2a,0x02,0xc6,0x23,
	0x20,0x43,0x10,0xad,0x4c,0x1f,0x1f,0x7c,0x5e,0x04,0x1d,0x06,0x09,0xc0,0x03,0xc0,
	0x3c,0xac,0x18,0xa0,0x13,0x73,0x8a,0x10,0x08,0x0e,0xa5,0xbd,0x73,0x55,0xbc,0x13,
	0x98,0xc0,0x5f,0xb8,0xc5,0x46,0x1c,0xc2,0x72,0x7e,0x61,0xb4,0xc6,0x4d,0x14,0xae,
	0xb9,0x8c,0x1b,0xb5,0xce,0x13,0xa6,0x15,0x78,0x7c,0x6e,0xcd,0x43,0xc4,0x94,0x56,
	0x57,0x22,0x02,0x71,0x71,0xcd,0x0f,0x19,0x00,0x67,0x8d,0xce,0x59,0x1a,0x17,0x0e,
	0xa8,0x36,0x0a,0x01,0x13,0xa7,0xc2,0xc8,0x58,0x0e,0x98,0x79,0x40,0x30,0x74,0x83,
	0xc2,0x3b,0x11,0x2e,0x1b,0x3f,0x0a,0x18,0xa6,0x49,0xc0,0x72,0x84,0x7c,0x29,0x26,
	0x3d,0xc6,0x87,0x21,0x77,0x91,0x99,0x7a,0x45,0x09,0xa6,0x95,0x7e,0x3b,0xbd,0x98,
	0x01,0xa4,0x80,0x0c,0xc4,0x87,0x97,0x0f,0x06,0xb5,0xc3,0x3b,0x3c,0x1e,0xc5,0x1a,
	0x70,0xc5,0xc8,0x17,0xcb,0x00,0x06,0x90,0x65,0x96,0xcc,0x5a,0x14,0xa6,0x5b,0xc5,
	0x16,0x4a,0xcd,0x53,0x1b,0xab,0xcc,0xb9,0x8b,0x99,0x8e,0x5f,0xbb,0x0d,0xb3,0xcf,
	0x5a,0x08,0xbc,0x40,0x42,0xc1,0x07,0x5d,0x26,0x0b,0x9b,0x51,0xa6,0x42,0x3d,0x16,
	0xcd,0x05,0xca,0x8c,0x9c,0x59,0xbe,0xc9,0x90,0x23,0x1d,0x5c,0xae,0x86,0x76,0x94,
	0xc5,0x8d,0x86,0x83,0x76,0xcc,0x14,0x14,0xad,0x46,0x12,0x37,0x16,0x11,0x26,0x3a,
	0x10,0x73,0x81,0x7c,0x97,0x61,0x86,0x65,0x03,0xcd,0x0a,0x99,0x2f,0x0b,0x73,0x8d,
	0x61,0xb9,0x78,0x8a,0x23,0x28,0x13,0x22,0x19,0xc7,0x07,0x78,0x89,0x73,0x4c,0x06,
	0x93,0x07,0x6b,0xcc,0x0a,0x64,0x68,0x95,0xca,0x48,0x59,0x7f,0x70,0x50,0xb4,0x50,
	0x1f,0x0b,0xb9,0xc1,0xb6,0x82,0x29,0x67,0x27,0x2f,0xc4,0x80,0x17,0x0d,0xb0,0x2b,
	0xa1,0x11,0x1d,0xba,0x0c,0xbf,0x4c,0x07,0x07,0x1c,0xc3,0x4c,0xc3,0x56,0x1b,0xca,
	0x75,0x5b,0x06,0xa5,0xb0,0xc1,0xa6,0x9d,0x95,0x17,0xac,0x03,0xa7,0x6d,0xca,0x15,
	0x83,0x42,0x0c,0x08,0xac,0x45,0x59,0x77,0x9a,0x2e,0xa3,0xc1,0x3d,0x30,0x2f,0x1b,
	0x09,0x2f,0x3a,0x20,0x14,0xb3,0xb1,0x1c,0xab,0x2b,0x0e,0xc4,0x93,0x9f,0x6e,0xb3,
	0x00,0x28,0x0f,0x64,0x9c,0x2f,0x35,0xc1,0x05,0x58,0x03,0x71,0x95,0x10,0x0d,0x8c,
	0x44,0x36,0x16,0x8a,0x7e,0x7a,0x01,0xc3,0x4f,0xc1,0x24,0x03,0x00,0xc0,0x3b,0x2a,
	0xcb,0x31,0xbb,0x50,0x26,0x24,0x78,0x4a,0x06,0xa8,0x00,0x1f,0xa9,0x41,0xaf,0x95,
	0xbc,0x52,0xb6,0x5f,0x7b,0x73,0x33,0x1a,0x6d,0xb1,0x1e,0x67,0xc5,0xcd,0x49,0x6f,
	0xc8,0x4b,0xcd,0x5b,0xc8,0x5a,0xce,0x6a,0x76,0x75,0x15,0xc4,0x47,0x06,0xb8,0x1a,
	0x37,0x0d,0xc0,0xc8,0x41,0xb2,0x13,0x09,0x74,0x76,0xc1,0xc1,0xcc,0x8c,0x54,0x4b,
	0x2a,0xa3,0x75,0x65,0xc5,0x1d,0xaa,0x23,0x06,0x60,0xc2,0x1f,0x71,0x01,0x61,0xba,
	0x3e,0x7d,0x6e,0x01,0xb7,0x56,0x5e,0xc8,0x0c,0x63,0x94,0x5c,0x38,0x09,0x89,0x5e,
	0x82,0x6e,0x95,0x24,0x18,0x7d,0x1e,0xb4,0x43,0xab,0x76,0x9c,0x74,0x80,0x3e,0x1c,
	0xce,0x9d,0x39,0x02,0x99,0x20,0x83,0x51,0xa8,0xb2,0x9f,0x66,0x82,0x0a,0x7f,0x7e,
	0xb4,0x9a,0x52,0xab,0x8f,0x8f,0x24,0xa3,0xc4,0xc1,0x80,0x95,0x1c,0xc7,0x1c,0x68,
	0x45,0xca,0x41,0xc9,0x31,0x10,0x9a,0x94,0x9e,0x48,0x58,0x31,0xb6,0x4f,0xc9,0x00,
	0x10,0xa6,0x51,0x09,0xbb,0xce,0x0e,0x32,0x22,0x35,0x5d,0x0a,0xae,0xce,0x53,0x4e,
	0x0a,0xcd,0x42,0xc9,0x49,0xc5,0x3c,0x24,0x30,0x0b,0xb4,0x14,0x18,0xa5,0xa0,0x6e,
	0xc8,0x27,0x27,0x0b,0xc3,0xc5,0x8a,0x2b,0x0b,0xbc,0x8e,0x91,0x9e,0x5b,0x7c,0x9c,
	0x89,0x93,0x5e,0x06,0x12,0xbf,0xc8,0x00,0x2f,0xa1,0x72,0x2c,0x13,0x06,0x7b,0x9b,
	0x78,0x8d,0x69,0x9c,0x86,0x49,0xa4,0x1c,0x32,0x08,0x24,0x6b,0x70,0x79,0x0a,0x0d,
	0x63,0x29,0x07,0x05,0x3a,0xa8,0xcf,0x49,0x1d,0x22,0x7b,0x58,0x00,0x89,0x57,0x16,
	0xc0,0x18,0x0d,0x19,0x9f,0xcc,0x42,0x1b,0x7b,0x68,0xc6,0x05,0xc2,0x34,0x09,0x1e,
	0xcd,0x11,0x8a,0x80,0x02,0x2d,0x1c,0x16,0xa9,0x98,0x49,0xaa,0x05,0x90,0xb1,0x07,
	0xac,0xcd,0x5a,0x1a,0x4e,0x11,0x05,0x0e,0xa6,0x50,0xcb,0x4a,0x1d,0xa9,0x94,0x4f,
	0xa1,0xb7,0x01,0xc3,0xb0,0x70,0x9d,0x01,0xba,0x49,0xb7,0x79,0xc6,0x07,0x8b,0x04,
	0x0a,0x1a,0xbc,0x59,0x0f,0x02,0x7f,0x87,0xb5,0x53,0x0c,0x2a,0x18,0x09,0x0b,0x0c,
	0x13,0x2a,0x16,0xce,0xce,0x52,0xbb,0x92,0x61,0xc6,0x9b,0x70,0x6a,0xca,0x31,0x17,
	0x24,0x19,0x35,0x0c,0x2d,0xc7,0x07,0xcc,0x05,0x65,0x9d,0x31,0x0b,0x35,0x4e,0x3c,
	0x10,0x7f,0x76,0x93,0x6e,0xc5,0x1f,0xc3,0x3c,0x15,0x31,0xab,0x80,0x03,0xc3,0x3b,
	0x1a,0xcc,0x2e,0x3e,0x1d,0x04,0xa7,0xbc,0x21,0x34,0xb9,0x5d,0xb9,0x8f,0xc7,0x4e,
	0x01,0x43,0x12,0x6b,0x2b,0x6d,0x65,0xc0,0x18,0x16,0xcd,0xcb,0x4b,0x77,0x56,0xc1,
	0xc1,0x47,0xc0,0x46,0xab,0x83,0x83,0x84,0x13,0xab,0x1b,0xa5,0xcd,0x0c,0x3f,0xaa,
	0xcc,0x48,0x4b,0x01,0x49,0x1f,0x1d,0x91,0x45,0xc7,0x5e,0x25,0x04,0xc5,0x13,0xb7,
	0x96,0x94,0x45,0xa8,0xbc,0x29,0x04,0x78,0x40,0x0d,0x79,0x72,0x65,0xcd,0x95,0x65,
	0x6a,0x7e,0xce,0x4a,0x5c,0xce,0x5a,0x77,0x9e,0x14,0x03,0x1b,0x30,0x4a,0x8a,0x76,
	0x9f,0x2e,0x1a,0x65,0x71,0x01,0xcb,0xbf,0x81,0x27,0x1d,0x9a,0x97,0x0a,0xad,0x7c,
	0x90,0x10,0x22,0x3a,0x89,0x1b,0xb8,0x01,0x6c,0x81,0x8a,0x1c,0x7b,0x66,0x11,0x6f,
	0x50,0xb9,0x70,0x6c,0x3c,0xb1,0xcc,0x5b,0x8a,0x8f,0x44,0xa2,0x4c,0x1d,0x4f,0xaf,
	0x43,0xa6,0x39,0x31,0x73,0x8e,0x25,0x5c,0xc6,0x2b,0x05,0x0b,0xa4,0x23,0x12,0xb2,
	0x0b,0xaa,0x1e,0xa9,0x08,0x28,0x2a,0x3f,0xc5,0x18,0xbe,0xcc,0x51,0xc2,0x61,0xcb,
	0x10,0x12,0xa2,0x55,0xc9,0x95,0x2c,0x2a,0x0d,0x01,0x16,0x0a,0xb3,0xb2,0x66,0x40,
	0x3f,0x2d,0x09,0xc1,0x4d,0x7f,0x80,0x36,0x06,0xc9,0x27,0x89,0x35,0x47,0x74,0x37,
	0x30,0x89,0x54,0xa5,0xa3,0x1e,0xc0,0x33,0x18,0xb5,0x7a,0x95,0x15,0xa3,0x12,0x30,
	0x1d,0x6c,0x86,0x37,0x8c,0x5d,0xb4,0x5a,0x2a,0x1a,0x2c,0x16,0x74,0x84,0x08,0x1f,
	0x67,0x82,0x05,0x7e,0x13,0xba,0x5b,0x55,0x1b,0x38,0x12,0xcc,0x21,0x22,0x5d,0x04,
	0xaf,0x5a,0x0f,0x0f,0x6c,0x40,0x14,0x0d,0x16,0x1d,0xce,0x17,0xce,0x3e,0xa8,0x0c,
	0xa2,0x03,0x6f,0x9a,0x04,0x18,0x1e,0xa7,0xbf,0x6f,0x43,0xb8,0x03,0x8a,0xca,0x49,
	0xba,0xcf,0x50,0x08,0xc8,0x62,0x6e,0x71,0xb0,0xcc,0x53,0xac,0xbd,0x9c,0x0b,0xb7,
	0xc0,0x03,0xa4,0x05,0x68,0x6c,0x72,0xc7,0x5d,0xce,0x86,0x48,0x41,0x30,0x12,0x6d,
	0x6d,0xc7,0x1b,0x09,0x10,0x77,0x9d,0xc0,0x4f,0x0e,0x07,0x1e,0xaa,0x24,0x1a,0x15,
	0x03,0xa3,0xcc,0xc2,0x46,0x1e,0x8a,0x65,0x56,0x32,0x64,0x93,0xcc,0x39,0x01,0x3c,
	0x0b,0x3d,0x1a,0x0c,0xa4,0x57,0xce,0x62,0x94,0x6c,0x3b,0x34,0x2f,0xcc,0x97,0x33,
	0x6b,0x83,0x8b,0x6a,0x5b,0x1d,0xa4,0x87,0x6e,0x39,0xbf,0x8a,0x15,0xa0,0x90,0x1c,
	0xca,0x97,0x85,0x1b,0x16,0xb7,0xcd,0x39,0x3e,0x0a,0xcb,0x0e,0x60,0xcf,0xc6,0x07,
	0xc1,0x10,0x16,0x82,0x75,0x84,0xc6,0x44,0x00,0xa4,0x4d,0xcb,0x02,0x5c,0xc3,0x45,
	0x0b,0xa9,0xc2,0xbd,0x9b,0x8b,0x9e,0x49,0xb9,0x19,0xb1,0xc1,0x44,0x18,0xb8,0x56,
	0x54,0xcf,0x13,0x4b,0x34,0x1f,0x89,0x47,0xa4,0x54,0x2f,0x02,0xc3,0x11,0xc4,0x9c,
	0x8e,0x4f,0xbc,0xc3,0x82,0x21,0x0d,0x42,0xac,0x96,0x66,0x86,0xcf,0x9d,0x96,0x93,
	0x66,0xc6,0xaf,0x50,0x06,0x35,0x02,0x01,0x34,0x28,0x04,0x6f,0x91,0x6c,0x85,0x71,
	0x96,0x75,0x17,0xc3,0x1a,0x8b,0x2d,0x1f,0x6f,0x9d,0x71,0xbd,0x68,0x9a,0x21,0x2a,
	0x03,0x30,0x09,0xc9,0x13,0x68,0x99,0x6f,0x5a,0x16,0x81,0x13,0x7b,0xc2,0x1a,0x78,
	0x74,0x87,0xc4,0x5e,0x4f,0x63,0x60,0x4e,0xb0,0x4e,0x0f,0x1f,0xbd,0xcf,0xb4,0x92,
	0x3b,0x77,0x25,0x2d,0x10,0xca,0x90,0x07,0x19,0xb2,0x29,0xa5,0x01,0x0d,0xbe,0x1c,
	0xbb,0x5a,0x13,0x13,0x08,0xc9,0x5a,0xcd,0x48,0x0b,0xc0,0x69,0x4d,0x16,0xa7,0xb2,
	0xcf,0xa4,0x8f,0x87,0x07,0xa8,0x17,0xa3,0x7d,0xc4,0x05,0x93,0x54,0x1c,0x18,0xa8,
	0x5b,0x4f,0x6b,0x88,0x3c,0xa1,0xcb,0x2f,0x32,0x2d,0x0b,0x1d,0x2d,0x28,0x22,0xb1,
	0xb5,0x08,0xa9,0x29,0x1e,0xce,0x81,0x8d,0x72,0xb1,0x10,0x2a,0x1b,0x78,0x8e,0x2d,
	0x27,0xcf,0x11,0x46,0x17,0x6d,0x87,0x04,0x19,0x9c,0x52,0x24,0x02,0x9a,0x6e,0x6a,
	0x15,0xcd,0x51,0xcf,0x26,0x17,0x10,0xce,0x39,0x38,0xc1,0x23,0xb9,0x4e,0x34,0x26,
	0x68,0x5c,0x16,0xaa,0x10,0x0f,0xad,0x5f,0xab,0x87,0xb8,0x4c,0xb4,0x49,0x67,0x6f,
	0x31,0x0e,0x7d,0xb5,0x0a,0x77,0xcb,0xc7,0x57,0x7f,0xc2,0x55,0xc7,0x4d,0xc6,0x44,
	0xc4,0x76,0x66,0x69,0x05,0xca,0x59,0x16,0xba,0x0e,0x35,0x19,0xca,0xc2,0x5f,0xb6,
	0x03,0x1d,0x64,0x66,0xcb,0xcf,0xc6,0x9c,0x4a,0x55,0x38,0xa1,0x69,0x75,0xcf,0x0d,
	0xae,0x21,0x16,0x7c,0xcc,0x0f,0x6d,0x15,0x71,0xbe,0x2c,0x61,0x72,0x15,0xb3,0x48,
	0x40,0xc6,0x1c,0x73,0x86,0x42,0x3a,0x1d,0x99,0x40,0x92,0x72,0x87,0x26,0x0c,0x61,
	0x0a,0xb0,0x5d,0xa9,0x66,0x8e,0x64,0x90,0x2c,0x08,0xc4,0x8f,0x2b,0x12,0x8b,0x22,
	0x93,0x47,0xaa,0xb6,0x8d,0x7a,0x92,0x1a,0x63,0x6e,0xb0,0x88,0x4c,0xa9,0x9f,0x9f,
	0x26,0xa1,0xce,0xcb,0x90,0x87,0x08,0xcd,0x08,0x74,0x5b,0xc0,0x5f,0xc7,0x23,0x04,
	0x88,0x86,0x8c,0x5e,0x46,0x23,0xb4,0x51,0xc7,0x10,0x04,0xa4,0x47,0x1d,0xb9,0xc4,
	0x1e,0x20,0x30,0x27,0x4b,0x1a,0xac,0xc0,0x45,0x58,0x1a,0xc7,0x54,0x10,0xc7,0x57,
	0xcb,0x3e,0x26,0x32,0x1f,0xb0,0x0c,0xa7,0xa2,0x72,0xc2,0x25,0x25,0x1f,0xcd,0xcf,
	0x9a,0x29,0x1f,0x10,0xb8,0x9e,0x83,0x8c,0x4d,0x6c,0x8e,0x99,0x81,0x40,0x16,0x06,
	0xbb,0xc6,0x10,0x2d,0xa5,0x62,0x2e,0x03,0x16,0x67,0x89,0x68,0x9d,0x79,0x8e,0x96,
	0x57,0xa0,0x08,0x20,0x18,0x26,0x7b,0x60,0x65,0x1a,0x19,0x73,0x3b,0x13,0x11,0x28,
	0xaa,0xc1,0x57,0x0d,0x30,0x67,0x46,0x10,0x99,0x41,0x02,0xce,0x0c,0x19,0x09,0x8d,
	0xc6,0x54,0x0b,0x67,0x74,0xcc,0x11,0xc8,0x36,0x1d,0x0a,0xc3,0x01,0x9a,0x90,0x12,
	0x3f,0x08,0x02,0xad,0x8a,0x57,0xae,0x11,0x82,0xb5,0x13,0xa8,0xc7,0x44,0x0e,0x58,
	0x01,0x11,0x1e,0xa4,0x4e,0xc5,0x5c,0x0d,0xad,0x86,0x51,0xa5,0xb3,0x15,0xc9,0xb2,
	0x60,0x8f,0x15,0xbe,0x57,0xb3,0x65,0xc8,0x13,0x9b,0x14,0x1a,0x0e,0xb8,0x4f,0x1b,
	0x12,0x63,0x97,0xb7,0x45,0x1c,0x38,0x0c,0x1d,0x1f,0x1c,0x03,0x38,0x02,0xc0,0xc0,
	0x4c,0xb9,0x80,0x71,0xc8,0x89,0x60,0x76,0xc4,0x23,0x07,0x26,0x09,0x27,0x1c,0x3f,
	0xcd,0x13,0xc2,0x11,0x75,0x8f,0x23,0x1f,0x27,0x58,0x3e,0x04,0x63,0x66,0x81,0x72,
	0xcf,0x0f,0xc9,0x3e,0x05,0x23,0xa9,0x90,0x17,0xc9,0x39,0x0e,0xc2,0x3c,0x2c,0x0d,
	0x14,0xa3,0xb8,0x33,0x36,0xbd,0x4b,0xbd,0x9f,0xc9,0x58,0x15,0x5d,0x06,0x7b,0x29,
	0x7d,0x75,0xca,0x0c,0x02,0xc3,0xc5,0x55,0x6b,0x48,0xcf,0xcb,0x59,0xce,0x50,0xa9,
	0x93,0x93,0x94,0x03,0xa9,0x0b,0xa7,0xc7,0x1c,0x3d,0xae,0xc6,0x5e,0x55,0x15,0x57,
};

static UINT8 opcode_select_0066[0x800] =
{
	0x34,0xaf,0x3f,0x9f,0x81,0x20,0x92,0x31,0x67,0xc1,0xc1,0xcc,0x0f,0x67,0x07,0x69,
	0x8b,0x10,0x5e,0x6a,0x86,0x3d,0x34,0x19,0x2c,0x03,0x01,0xcf,0x38,0x85,0x2f,0x42,
	0x18,0x9d,0x0f,0x71,0xc2,0xc6,0x38,0x7a,0x6e,0x4c,0x18,0xa6,0x2d,0x15,0xa1,0xbe,
	0xa5,0x8b,0xc9,0xa5,0xac,0xb8,0x9e,0x25,0x37,0x80,0x2b,0xaf,0xca,0x0c,0x1b,0x07,
	0x47,0x25,0xc6,0xa8,0xc5,0x5f,0x02,0xa5,0xb1,0x19,0x8f,0x73,0xc5,0x5c,0x01,0xcc,
	0xcd,0x16,0x6b,0xb0,0xc0,0x08,0x51,0x53,0xcd,0x07,0x72,0x19,0xb2,0xc5,0xc6,0x04,
	0xa9,0xaa,0x0d,0xbd,0x23,0x7f,0xb6,0xb2,0x49,0x7d,0x86,0x3a,0xc6,0xcf,0x29,0x68,
	0x39,0x01,0x30,0x7b,0x24,0x74,0x44,0x4e,0xb9,0xc0,0x42,0x37,0x88,0x52,0x1d,0x13,
	0x64,0x58,0x0a,0x60,0x13,0x6a,0x06,0x77,0x14,0x45,0x5b,0x5e,0x9d,0x00,0x7e,0x86,
	0x32,0x8a,0xb3,0x91,0x0a,0x68,0x36,0x97,0xc9,0x41,0x5b,0x15,0x19,0x0e,0x16,0x6d,
	0x60,0xaa,0x2d,0x5e,0x48,0x11,0x81,0x28,0xbf,0xca,0x5d,0x1a,0x89,0x5c,0xcd,0x4a,
	0x20,0xa0,0x54,0x47,0xcd,0x27,0x69,0x65,0x06,0x92,0x50,0x00,0x61,0xae,0xc9,0x09,
	0x65,0x0a,0x47,0x01,0xb2,0xc8,0x54,0xc4,0x26,0x6c,0x2b,0x5b,0x02,0x41,0x0e,0xa0,
	0xcc,0x14,0x03,0xad,0xce,0x1d,0xb8,0x0f,0x62,0x3a,0x36,0x07,0x4d,0x0a,0x98,0x46,
	0x51,0x26,0x18,0x7b,0x2b,0x17,0x17,0xb2,0x2d,0x0c,0x15,0x0e,0x01,0x80,0x0b,0x80,
	0x57,0x7a,0x10,0x68,0x1b,0xbd,0xcc,0x18,0x00,0x06,0x79,0x73,0xbd,0x24,0x72,0x1b,
	0xc6,0x9c,0x2c,0x62,0x93,0x23,0x14,0x9a,0xbc,0xba,0xb1,0x70,0x98,0x2a,0x1c,0x66,
	0x63,0xce,0x13,0x71,0x8c,0x1b,0x64,0x1d,0xa4,0xb2,0xbe,0x9b,0x26,0x9e,0xc8,0x3d,
	0x3c,0x47,0x0a,0xb5,0xb5,0x9b,0x07,0x11,0x08,0xaf,0xc1,0x8c,0x30,0x12,0x1f,0x06,
	0x6a,0x4b,0x02,0x09,0x1b,0x65,0x86,0x94,0x31,0x06,0xc6,0xa5,0x3f,0x59,0xa2,0xcb,
	0x86,0x44,0x19,0x49,0x13,0x40,0x02,0x10,0x64,0x2e,0x80,0xbc,0xc6,0xb2,0x5a,0x43,
	0x56,0x98,0xcd,0x50,0xab,0xc1,0xc9,0xac,0x3a,0x01,0x64,0xc7,0xba,0x44,0x73,0xc6,
	0x09,0x78,0xc0,0x04,0x82,0xcd,0xc3,0x07,0x0e,0x71,0x8b,0x44,0x57,0x16,0x8f,0x12,
	0xb4,0x93,0x88,0x1f,0x9f,0x08,0x0e,0xce,0xa7,0xcc,0x96,0x29,0x1c,0x64,0x28,0x8f,
	0x1e,0x37,0x87,0x38,0x13,0x77,0x8a,0x63,0xc3,0xc9,0xca,0x2c,0x7f,0x05,0x7d,0x81,
	0x29,0x00,0x72,0x3f,0x27,0x8d,0x0f,0x34,0x43,0x03,0xcd,0x20,0x64,0x27,0x56,0x1e,
	0x87,0x0d,0x8e,0xce,0xc0,0x30,0x6e,0x99,0xce,0x46,0x15,0x35,0x66,0xc2,0xaa,0xc8,
	0x93,0xc1,0xc2,0xcb,0xaa,0x96,0x1c,0x1c,0x7b,0x23,0x1a,0x4a,0x1e,0x19,0x43,0x45,
	0x18,0xbd,0xcf,0xb2,0xc3,0xb1,0xc2,0xa7,0x0b,0x87,0x02,0xc9,0x48,0x03,0xbd,0xc1,
	0xb1,0x63,0xa4,0xcc,0x46,0x5b,0x1b,0x47,0x11,0x89,0x0f,0xa4,0xc7,0xbd,0x2b,0x0e,
	0xc5,0x0f,0xa9,0x8a,0x02,0xa6,0xa0,0xc7,0x8e,0x2f,0x30,0xbb,0xb4,0x21,0x70,0x21,
	0x17,0x03,0x63,0x8d,0x6c,0xc4,0x5a,0xaf,0x42,0x48,0x82,0xc0,0x1f,0x05,0x60,0x4c,
	0x69,0x19,0x15,0x7e,0x04,0x6f,0x2b,0x0f,0x0f,0x14,0x97,0x2b,0x8b,0x3d,0x13,0x92,
	0xa3,0x28,0x0e,0x79,0x60,0x8d,0x64,0xcf,0xc7,0x1f,0x7a,0x0b,0x65,0xb7,0x8e,0x1d,
	0xcb,0x27,0x04,0x00,0x7a,0x3a,0x30,0xab,0xc2,0x49,0x75,0x91,0x56,0x59,0x48,0x13,
	0x01,0x48,0x45,0x51,0x1c,0x7d,0x61,0x14,0x77,0x4c,0x06,0x9e,0xc5,0xcb,0xbe,0x7d,
	0x08,0x5b,0x07,0xa6,0xc0,0x48,0x5c,0x8d,0x0d,0x31,0x0b,0xb5,0xc7,0x18,0x05,0xce,
	0x3b,0x4b,0x1e,0xcc,0xba,0xac,0x09,0x8b,0x32,0x8d,0x55,0x0b,0x08,0x80,0x44,0x4d,
	0x9f,0x58,0x7f,0x21,0x43,0x55,0xa4,0x37,0x0e,0x6a,0x08,0x17,0x6b,0x3e,0x67,0xc7,
	0x72,0x39,0x6c,0x2c,0xad,0xbd,0x4e,0x12,0xb7,0x61,0x16,0xaf,0x8f,0x9b,0x2e,0xbf,
	0x94,0x36,0x9b,0x28,0x88,0x29,0x90,0xa8,0xaa,0xa3,0x1d,0x82,0x22,0x0e,0x62,0x12,
	0x4a,0x05,0x9c,0x94,0x3e,0x7c,0x1b,0x01,0xa2,0xaa,0x91,0x8d,0x96,0xce,0x25,0x36,
	0x4d,0x75,0xa3,0xa7,0x93,0x15,0x76,0x46,0x0e,0xb0,0x86,0x17,0xb5,0x09,0xb1,0x7e,
	0x41,0xb3,0xbe,0x09,0x6d,0x3d,0x2d,0x88,0x04,0xb9,0xc8,0x35,0x53,0x01,0xc7,0x2d,
	0xc4,0xbe,0xc7,0x55,0x10,0xb3,0x16,0x70,0x26,0x77,0xaa,0xc0,0xa2,0xc0,0x41,0x14,
	0x90,0xcf,0x52,0x0a,0xc9,0x51,0xcb,0x20,0x6a,0x7c,0xcb,0xae,0xc4,0x02,0xbb,0xba,
	0x70,0xc2,0x39,0x77,0xc5,0xc5,0x55,0x75,0x9e,0x91,0xc0,0xc7,0x14,0x95,0x14,0xa0,
	0x3a,0x92,0x3e,0x85,0x58,0x18,0xc2,0xc8,0xc4,0x2f,0x31,0x58,0x6c,0x32,0x85,0x08,
	0x18,0x64,0x20,0x01,0x7f,0x90,0x06,0x4f,0x47,0x5c,0x34,0x02,0x66,0x8c,0x38,0x33,
	0x02,0x9b,0x27,0x85,0x2e,0x8f,0x57,0x55,0x59,0x03,0x70,0x1c,0x10,0x79,0x68,0xbe,
	0x94,0x42,0x42,0x03,0x8b,0x93,0xcc,0x4c,0x03,0x72,0xca,0xc1,0xc4,0x28,0xb2,0xc0,
	0xc7,0xc5,0x2d,0x0e,0x1a,0x6f,0x88,0x08,0x48,0x69,0xbc,0x5f,0x1b,0x0e,0xad,0xcd,
	0xa4,0xc1,0xa1,0xc0,0xc2,0x2e,0x78,0x14,0x4f,0x00,0x55,0xa9,0xb4,0xa5,0x02,0x05,
	0xb9,0x5a,0x0f,0x0d,0x45,0x6a,0x81,0x2e,0x15,0x47,0xad,0x31,0x08,0xc7,0x3c,0x1e,
	0x80,0x10,0x05,0x11,0xcb,0x96,0x27,0x13,0xad,0xa0,0x98,0x0d,0x9a,0x5d,0x01,0x16,
	0x87,0x19,0xcc,0xc0,0x0a,0x5e,0x14,0x1e,0x6b,0xc6,0x2e,0x76,0x0d,0xce,0x61,0x0f,
	0x7a,0x9b,0x29,0x12,0x33,0x19,0x0d,0x06,0x64,0x21,0x83,0x37,0x15,0x6b,0xc8,0x32,
	0x69,0x6d,0x09,0x97,0x60,0xb4,0xcf,0x09,0x7e,0x2e,0x6d,0xa5,0x84,0x0f,0xc3,0x0c,
	0x02,0x12,0x72,0x30,0x07,0x0a,0xbb,0xcd,0x71,0x38,0x04,0x4d,0x10,0x01,0x03,0x04,
	0x1b,0x4d,0x1e,0x8c,0x8c,0x39,0x7f,0xca,0xb1,0x84,0xcd,0xb4,0xa8,0x8e,0x58,0x1f,
	0x55,0x11,0x5c,0x04,0x5e,0x95,0x0f,0x8a,0x0d,0xa7,0xcf,0x58,0x03,0x5c,0x33,0x57,
	0x18,0xbb,0xaa,0xc5,0xbe,0x93,0x17,0x97,0x57,0x1d,0x58,0x77,0xc0,0x0b,0x97,0x44,
	0x12,0x8a,0x49,0x41,0x15,0x0c,0x65,0x72,0x50,0x5d,0x63,0x34,0x63,0xc5,0x89,0x33,
	0x09,0x26,0x1a,0xa9,0x4c,0xb7,0xa7,0x9c,0x10,0x1e,0x87,0x83,0x36,0xab,0x3d,0x8d,
	0x91,0x22,0x80,0x23,0x77,0xcb,0xcb,0xc6,0x1b,0x77,0x13,0x79,0x9b,0x04,0x40,0x76,
	0x96,0x2f,0x36,0x09,0x2e,0x17,0x15,0xc1,0x3a,0x95,0x2d,0x54,0x0c,0x8f,0x1b,0x6d,
	0xcc,0xc8,0x3a,0x6a,0x72,0x5a,0x0c,0xa4,0x3f,0x05,0xa5,0xbc,0xa7,0x9b,0xc7,0xa7,
	0xa8,0xba,0x8c,0x37,0x35,0x90,0x29,0xab,0xc4,0x1c,0x0b,0x13,0x59,0x37,0xcc,0xaa,
	0xcb,0x49,0x12,0xa7,0xb5,0x09,0x9f,0x6f,0xcf,0x42,0x15,0xc2,0xc3,0x02,0x7b,0xb2,
	0xce,0x18,0x47,0x45,0xc7,0x13,0x62,0x09,0xb6,0xcf,0xcc,0x14,0xad,0xae,0x19,0xbf,
	0x21,0x63,0xb4,0xb6,0x57,0x61,0x96,0x28,0xcc,0xc5,0x3b,0x74,0x2b,0x15,0x32,0x67,
	0x26,0x64,0x52,0x58,0xbd,0xca,0x54,0x35,0x98,0x4c,0x0d,0x03,0x78,0x46,0x1a,0x7c,
	0x03,0x76,0x16,0x6b,0x00,0x5b,0x4d,0x40,0x8f,0x10,0x6e,0x96,0x20,0x9a,0xb1,0x83,
	0x18,0x1a,0x74,0x24,0x85,0xc7,0x5f,0x4d,0x05,0x09,0x1e,0x02,0x7d,0x7c,0xae,0x3f,
	0x40,0x5e,0x01,0x91,0x2a,0xbb,0xc0,0x4b,0x0e,0x99,0x42,0xc7,0x5c,0x22,0xa2,0x4a,
	0x59,0xc7,0x25,0x79,0x75,0x16,0x80,0x4e,0x10,0x71,0xac,0xc7,0x1d,0x75,0x1a,0x59,
	0x15,0xb6,0xc2,0x4a,0xce,0x34,0x70,0x29,0x4d,0x12,0x5f,0x1e,0xa2,0xc6,0x00,0x17,
	0xaf,0xc4,0x0d,0xba,0x1b,0x7e,0x28,0x24,0x13,0x53,0x1a,0x8a,0x50,0x47,0x34,0x0c,
	0x67,0x29,0x07,0x07,0xb6,0x3f,0x1c,0x05,0x1e,0x15,0x90,0x1f,0x90,0x41,0x6a,0x04,
	0x74,0x0b,0xbf,0xc2,0x0c,0x10,0x16,0x65,0x6f,0xbf,0x26,0x62,0x0b,0xcc,0x8e,0x2e,
	0x7e,0x81,0x21,0x00,0x88,0xb8,0xbe,0xb5,0x60,0x8a,0x38,0x7a,0x73,0xc0,0x03,0x6d,
	0x9c,0x0b,0x78,0x0d,0xa0,0xb6,0xbc,0x89,0x34,0x8c,0xc2,0x2f,0x3e,0x59,0x1a,0xb7,
	0xb7,0x89,0x13,0x01,0x18,0xab,0xcf,0x9c,0x32,0x06,0x0f,0x16,0x76,0x55,0x12,0x1d,
	0x0b,0x75,0x96,0x86,0x23,0x16,0xcc,0xa7,0x3d,0x4f,0xa6,0xc5,0x96,0x52,0x09,0x57,
	0x03,0x56,0x12,0x04,0x78,0x3c,0x90,0xb8,0xc8,0xb6,0x44,0x5d,0x48,0x8a,0xc3,0x4e,
	0xa9,0xcb,0xc3,0xa8,0x28,0x15,0x78,0xcd,0xbe,0x52,0x6f,0xcc,0x1d,0x68,0xce,0x14,
	0x92,0xc3,0xc9,0x13,0x1e,0x6d,0x9b,0x52,0x41,0x02,0x9f,0x06,0xb0,0x81,0x98,0x0f,
	0x8d,0x18,0x1e,0xc4,0xa3,0xc6,0x84,0x3b,0x08,0x78,0x2a,0x9f,0x0a,0x35,0x97,0x3a,
	0x03,0x6b,0x9a,0x73,0xcd,0xc3,0xc4,0x2e,0x63,0x11,0x61,0x91,0x3b,0x10,0x62,0x3d,
	0x25,0x9d,0x1b,0x36,0x5d,0x17,0xc7,0x22,0x78,0x25,0x48,0x0a,0x97,0x19,0x9e,0xc0,
	0xca,0x32,0x72,0x8b,0xc4,0x50,0x05,0x27,0x7a,0xcc,0xae,0xc2,0x81,0xcf,0xcc,0xc5,
	0xae,0x84,0x67,0x21,0x0e,0x5c,0x0a,0x09,0x5d,0x5b,0x0c,0xbf,0xc1,0xb6,0xc9,0xb5,
	0xcc,0xa3,0x1f,0x97,0x12,0xc3,0x5e,0x17,0xbf,0xcf,0xb5,0x73,0xa0,0xc2,0x50,0x4d,
	0x0b,0x59,0x01,0x99,0x1b,0xa0,0xc9,0xbf,0x29,0x1e,0xcf,0x1b,0xad,0x9a,0x12,0xa4,
	0xa2,0xcd,0x9e,0x2d,0x32,0xb9,0xb0,0x33,0x60,0x33,0x07,0x17,0x73,0x9d,0x70,0xca,
	0x44,0xab,0x54,0x5e,0x18,0x92,0xce,0x0f,0x11,0x7c,0x5a,0x79,0x09,0x05,0x6e,0x14,
	0x7f,0x29,0x1b,0x1b,0x00,0x85,0x29,0x9b,0x2f,0x03,0x80,0xa1,0x2a,0x1e,0x65,0x7c,
	0x9d,0x78,0xc5,0xcd,0x0f,0x6a,0x1f,0x75,0xb3,0x9e,0x0d,0xc5,0x25,0x14,0x10,0x6a,
	0x28,0x32,0xa9,0xc8,0x57,0x69,0x83,0x48,0x4f,0x5e,0x03,0x15,0x5e,0x5b,0x47,0x61,
	0x71,0x00,0x6b,0x5a,0x16,0x8c,0xcf,0xc1,0xbc,0x61,0x18,0x4d,0x13,0xa4,0xca,0x5e,
	0x42,0x9d,0x19,0x23,0x1f,0xb7,0xcd,0x0c,0x11,0xc0,0x39,0x55,0x0a,0xc2,0xbe,0xa8,
	0x1d,0x9b,0x20,0x9d,0x43,0x1f,0x18,0x90,0x52,0x53,0x8d,0x46,0x63,0x33,0x5d,0x43,
	0xa0,0x35,0x1e,0x76,0x18,0x07,0x7b,0x2c,0x77,0xcd,0x62,0x2b,0x70,0x2e,0xaf,0xbf,
	0x58,0x06,0xb3,0x71,0x02,0xab,0x9f,0x89,0x3c,0xbb,0x86,0x24,0x89,0x2a,0x98,0x3b,
	0x82,0xaa,0xae,0xa1,0x0d,0x92,0x30,0x1e,0x7e,0x06,0x5c,0x11,0x8e,0x86,0x2c,0x6c,
	0x0b,0x15,0xa6,0xae,0x83,0x9d,0x84,0xc0,0x37,0x24,0x53,0x69,0xa1,0xa3,0x81,0x05,
	0x66,0x50,0x1e,0xb2,0x96,0x07,0xb7,0x1d,0xb5,0x6e,0x5f,0xb1,0xbc,0x1d,0x7d,0x2f,
	0x3f,0x98,0x14,0xbd,0xc2,0x27,0x45,0x15,0xc9,0x3f,0xca,0xbc,0xcd,0x43,0x04,0xb1,
	0x02,0x60,0x34,0x6b,0xae,0xca,0xa6,0xce,0x5f,0x00,0x82,0xc5,0x4c,0x1a,0xc3,0x47,
	0xc5,0x22,0x76,0x6c,0xc1,0xac,0xca,0x12,0xb9,0xbe,0x60,0xc8,0x2b,0x6b,0xcb,0xcb,
	0x43,0x69,0x8c,0x83,0xce,0xcd,0x00,0x87,0x00,0xa2,0x28,0x80,0x2c,0x95,0x46,0x0c,
	0xc8,0xc2,0xce,0x2d,0x23,0x46,0x70,0x20,0x95,0x18,0x0c,0x78,0x22,0x15,0x63,0x82,
	0x16,0x51,0x59,0x42,0x36,0x12,0x7a,0x9c,0x3a,0x31,0x12,0x89,0x25,0x18,0x95,0x3c,
	0x9f,0x41,0x43,0x4f,0x17,0x60,0x04,0x65,0x74,0xbc,0x86,0x54,0x54,0x17,0x9b,0x81,
	0xc2,0x5a,0x17,0x18,0x62,0xc4,0xcb,0xce,0x2a,0xb6,0xca,0xc9,0xcf,0x3f,0x1e,0x0e,
	0x7f,0x98,0x18,0x5e,0x79,0xb8,0x49,0x0b,0x1e,0xaf,0xc7,0xa0,0xcf,0xa5,0xca,0xcc,
	0x3c,0x68,0x00,0x51,0x10,0x43,0xad,0xb0,0xa7,0x12,0x11,0xbd,0x44,0x1b,0x19,0x5b,
	0x76,0x91,0x3c,0x05,0x59,0xaf,0x23,0x18,0xc9,0x3e,0x0a,0x90,0x04,0x11,0x01,0xc1,
	0x84,0x25,0x03,0xaf,0xa2,0x8a,0x19,0x88,0x4b,0x15,0x02,0x97,0x09,0xc2,0xce,0x1a,
	0x40,0x00,0x0a,0x7b,0xcc,0x3c,0x66,0x19,0xc4,0x71,0x1b,0x6a,0x89,0x3b,0x06,0x31,
	0x09,0x19,0x16,0x78,0x33,0x93,0x35,0x05,0x7b,0xc2,0x20,0x79,0x7d,0x1d,0x85,0x7c,
	0xb0,0xc5,0x1d,0x6e,0x3c,0x7d,0xa7,0x94,0x1b,0xcd,0x1c,0x12,0x06,0x62,0x32,0x13,
	0x1a,0xb9,0xc3,0x6d,0x3a,0x14,0x53,0x04,0x15,0x17,0x14,0x0b,0x53,0x0a,0x9c,0x9c,
	0x2b,0x63,0xc0,0xb5,0x94,0xc7,0xb0,0xaa,0x9e,0x46,0x0f,0x43,0x01,0x42,0x14,0x40,
	0x87,0x1b,0x9a,0x19,0xa3,0xc5,0x46,0x17,0x42,0x31,0x41,0x0c,0xb9,0xae,0xcf,0xbc,
	0x81,0x07,0x85,0x41,0x0d,0x46,0x6b,0xce,0x1f,0x85,0x52,0x06,0x9a,0x57,0x5f,0x05,
	0x1c,0x75,0x62,0x4e,0x4b,0x73,0x36,0x73,0xcb,0x99,0x31,0x1d,0x34,0x0e,0xad,0x5a,
	0xb3,0xa3,0x8e,0x04,0x0a,0x97,0x93,0x24,0xa9,0x2f,0x9d,0x83,0x30,0x90,0x21,0x6b,
};


static int decrypt_type0(int val,int param,int opcode)
{
	int a = val;
	int swap = param & 0x03;

	if (swap == 1) a = BITSWAP8(a,5,4,3,6,7,1,2,0);
	if (swap == 2) a = BITSWAP8(a,0,5,3,2,4,7,6,1);
	if (swap == 3) a = BITSWAP8(a,0,1,7,5,3,6,2,4);

	val = 0x3d;
	if (BIT(a,0)) val ^= 0x23;
	if (BIT(a,1)) val ^= 0x08;
	if (BIT(a,2)) val ^= 0x04;
	if (BIT(a,3)) val ^= 0x20;
	if (BIT(a,4)) val ^= 0x01;
	if (BIT(a,6)) val ^= 0x10;
	if (BIT(a,5))
	{
		val ^= 0xc0;

		if (param & 0x10)
		{
			val ^= 0xb3;
		}
		else
		{
			if (param & 0x02) val ^= 0x40;
			if (param & 0x08) val ^= 0x40;
			if (opcode) val ^= 0x40;
		}
	}
	if (BIT(a,7))
	{
		val ^= 0x80;

		if (param & 0x04) val ^= 0x25;

		if (param & 0x02) val ^= 0x40;
		if (param & 0x08) val ^= 0x40;
		if (opcode) val ^= 0x40;
	}

	if (param & 0x02) val ^= 0xc0;
	if (param & 0x08) val ^= 0xe1;
	if (param & 0x10) val ^= 0x23;
	if (opcode) val ^= 0xc0;

	if (param & 0x08) val = BITSWAP8(val,7,6,5,3,2,1,4,0);

	return val;
}

static int decrypt_type1(int val,int param,int opcode)
{
	int a = val;
	int swap;

	param = (param << 1) | opcode;
	if (param & 0x02) param ^= 1;
	if (param & 0x08) param ^= 1;
	if (param & 0x10) param ^= 1;

	swap = param & 0x03;

	if (swap == 1) a = BITSWAP8(a,2,6,0,7,4,3,5,1);
	if (swap == 2) a = BITSWAP8(a,7,4,2,0,5,3,6,1);
	if (swap == 3) a = BITSWAP8(a,0,2,3,5,1,4,6,7);
	if (param & 0x04) a = BITSWAP8(a,7,6,5,4,0,2,3,1);

	val = 0x21;
	if (BIT(a,0)) val ^= 0x02;
	if (BIT(a,1)) val ^= 0xd4;
	if (BIT(a,2)) val ^= 0x08;
	if (BIT(a,3)) val ^= 0x21;
	if (BIT(a,4)) val ^= 0x01;
	if (BIT(a,5)) val ^= 0x48;
	if (BIT(a,6)) val ^= 0xd8;
	if (BIT(a,7)) val ^= 0x7c;

	if (param & 0x10) val ^= 0x48;
	if (param & 0x20) val ^= 0x84;

	if (param & 0x08) val = BITSWAP8(val,7,6,1,4,3,2,5,0);

	return val;
}

static int decrypt_type2(int val,int param,int opcode)
{
	int a = val;
	int swap;

	param = (param << 1) | opcode;
	if (param & 0x04) param ^= 1;
	if (param & 0x08) param ^= 1;

	swap = param & 0x03;

	if (swap == 1) a = BITSWAP8(a,3,5,0,1,7,2,6,4);
	if (swap == 2) a = BITSWAP8(a,3,4,7,6,5,1,2,0);
	if (swap == 3) a = BITSWAP8(a,4,2,0,5,3,6,7,1);

	val = 0x04;
	if (BIT(a,0)) val ^= 0x42;
	if (BIT(a,1)) val ^= 0x84;
	if (BIT(a,2)) val ^= 0x70;
	if (BIT(a,3)) val ^= 0xa4;
	if (BIT(a,4)) val ^= 0x22;
	if (BIT(a,5)) val ^= 0xcf;
	if (BIT(a,6)) val ^= 0x04;
	if (BIT(a,7)) val ^= 0x47;

	if (BIT(a,7) && BIT(a,6))
		val ^= 0xf4;

	if (param & 0x04) val ^= 0x0a;
	if (param & 0x08) val ^= 0x47;
	if (param & 0x10) val ^= 0x12;
	if (param & 0x20) val ^= 0x84;

	return val;
}

static int decrypt_type3(int val,int param,int opcode)
{
	int a = val;
	int swap;

	param = (param << 1) | opcode;
	if (param & 0x04) param ^= 1;
	if (param & 0x08) param ^= 1;
	if (param & 0x10) param ^= 1;

	swap = param & 0x03;

	if (swap == 1) a = BITSWAP8(a,2,3,0,4,5,7,6,1);
	if (swap == 2) a = BITSWAP8(a,2,4,7,0,5,1,3,6);
	if (swap == 3) a = BITSWAP8(a,0,3,2,7,5,1,6,4);

	if (param & 0x08)	a = BITSWAP8(a,7,6,5,4,2,3,1,0);
	if (BIT(a,4))		a = BITSWAP8(a,7,6,5,4,2,3,1,0);

	val = 0x68;
	if (BIT(a,2)) val ^= 0x26;
	if (BIT(a,3)) val ^= 0x80;
	if (BIT(a,5)) val ^= 0x10;
	if (param & 0x04)
	{
		if (BIT(a,0)) val ^= 0x04;
		if (BIT(a,1)) val ^= 0x01;
		if (BIT(a,4)) val ^= 0x5d;
		if (BIT(a,6)) val ^= 0x43;
		if (BIT(a,7)) val ^= 0xf6;
	}
	else
	{
		if (BIT(a,0)) val ^= 0x43;
		if (BIT(a,1)) val ^= 0x40;
		if (BIT(a,4)) val ^= 0x1f;
		if (BIT(a,6)) val ^= 0x01;
		if (BIT(a,7)) val ^= 0xb2;
	}

	if (param & 0x04) val ^= 0x01;
	if (param & 0x08) val ^= 0x08;
	if (param & 0x10) val ^= 0x10;
	if (param & 0x20) val ^= 0x80;

	return val;
}

static int decrypt_type4(int val,int param,int opcode)
{
	int a = val;
	int j;
	int swap;
	int v;

	param = (param << 1) | opcode;
	param ^= 1;
	if (param & 0x08) param ^= 1;
	if (param & 0x10) param ^= 1;

	swap = param & 0x03;
	v = (param & 0x0c) >> 2;

	if (swap == 1) a = BITSWAP8(a,2,3,0,4,5,7,6,1);
	if (swap == 2) a = BITSWAP8(a,2,4,7,0,5,1,3,6);
	if (swap == 3) a = BITSWAP8(a,0,3,2,7,5,1,6,4);

	val = 0xea;
	if (BIT(a,4)) val ^= 0x41;
	if (BIT(a,3)) val ^= 0x07;
	if (BIT(a,5)) val ^= 0x04;
	if (BIT(a,2)) val ^= 0x18;
	if (BIT(a,6)) val ^= 0x10;
	if (BIT(a,0)) val ^= 0xa0;
	if (BIT(a,7)) val ^= 0x60;
	if (BIT(a,1)) val ^= 0x80;

	if (param & 0x02) val ^= 0x1f;
	if (param & 0x20) val ^= 0x1f;

	if (!BIT(a,5) && ((param & 0x10) || !BIT(a,6)))
	{
		if (BIT(a,0)) val ^= 0x20;
		if (BIT(a,7)) val ^= 0x21;
		if (BIT(a,1)) val ^= 0xe0;
		if (BIT(a,4)) val ^= 0xe1;
	}

	for (j = 0;j < v;j++)
	{
		val = BITSWAP8(val,7,6,5,2,1,3,4,0);
	}

	return val;
}

static int decrypt_type5(int val,int param,int opcode)
{
	int a = val;
	int swap;

	param = (param << 1) | opcode;
	if (param & 0x02) param ^= 1;
	if (param & 0x10) param ^= 1;
	if (param & 0x20) param ^= 1;

	swap = param & 0x03;

	if (swap == 1) a = BITSWAP8(a,2,1,6,4,5,7,3,0);
	if (swap == 2) a = BITSWAP8(a,7,0,4,3,2,1,5,6);
	if (swap == 3) a = BITSWAP8(a,3,4,7,5,1,6,0,2);

	if (param & 0x04)
	{
		val = 0x22;
		if (param & 0x08) val ^= 0x04;
		if (param & 0x10) val ^= 0x08;
		if (param & 0x20) val ^= 0x80;

		if (BIT(a,0)) val ^= 0xd6;
		if (BIT(a,1)) val ^= 0x30;
		if (BIT(a,2)) val ^= 0x11;
		if (BIT(a,3)) val ^= 0x04;
		if (BIT(a,4)) val ^= 0x08;
		if (BIT(a,5)) val ^= 0x42;
		if (BIT(a,6)) val ^= 0xc6;
		if (BIT(a,7)) val ^= 0x03;
	}
	else
	{
		val = 0x24;
		if (param & 0x08) val ^= 0x01;
		if (param & 0x10) val ^= 0x08;
		if (param & 0x20) val ^= 0x80;

		if (BIT(a,0)) val ^= 0x54;
		if (BIT(a,1)) val ^= 0x08;
		if (BIT(a,2)) val ^= 0x82;
		if (BIT(a,3)) val ^= 0x01;
		if (BIT(a,4)) val ^= 0x30;
		if (BIT(a,5)) val ^= 0x40;
		if (BIT(a,6)) val ^= 0x52;
		if (BIT(a,7)) val ^= 0x86;
	}

	if (BIT(a,2) ^ BIT(a,7))
	{
		if (BIT(a,4) ^ BIT(a,1))
			val ^= 0x38;

		if (BIT(a,0) ^ BIT(a,5) ^ BIT(a,6))
			val ^= 0x02;
	}

	return val;
}

static int decrypt_type6(int val,int param,int opcode)
{
	int a = val;
	int swap;

	param = (param << 1) | opcode;
	if (param & 0x02) param ^= 1;
	if (param & 0x04) param ^= 1;
	if (param & 0x10) param ^= 1;

	swap = param & 0x03;

	if (swap == 1) a = BITSWAP8(a,2,1,6,4,5,7,3,0);
	if (swap == 2) a = BITSWAP8(a,7,0,4,3,2,1,5,6);
	if (swap == 3) a = BITSWAP8(a,3,4,7,5,1,6,0,2);

	val = 0x0e;
	if (BIT(a,0)) val ^= 0x33;
	if (BIT(a,1)) val ^= 0x8e;
	if (BIT(a,2)) val ^= 0x01;
	if (BIT(a,3)) val ^= 0xe0;
	if (BIT(a,4)) val ^= 0x5b;
	if (BIT(a,5)) val ^= 0xea;
	if (BIT(a,6)) val ^= 0x58;
	if (BIT(a,7)) val ^= 0x0e;

	if (BIT(a,1) && BIT(a,5))
		val ^= 0xa8;

	if (BIT(a,6))
	{
		if (BIT(a,0) ^ BIT(a,4) ^ BIT(a,1))
			val ^= 0x11;
	}
	if (BIT(a,1))
	{
		if (!BIT(a,5))
		{
			if (BIT(a,0) ^ BIT(a,4))
				val ^= 0x11;
		}
	}

	if (param & 0x04) val ^= 0x24;
	if (param & 0x08) val ^= 0x4a;
	if (param & 0x10) val ^= 0x80;

	return val;
}

static int decrypt(int val,int param,int opcode)
{
	switch ((param & 0xe0) >> 5)
	{
		case 0: return decrypt_type0(val,param & 0x1f,opcode);
		case 1: return decrypt_type1(val,param & 0x1f,opcode);
		case 2: return decrypt_type2(val,param & 0x1f,opcode);
		case 3: return decrypt_type3(val,param & 0x1f,opcode);
		case 4: return decrypt_type4(val,param & 0x1f,opcode);
		case 5: return decrypt_type5(val,param & 0x1f,opcode);
		case 6: return decrypt_type6(val,param & 0x1f,opcode);
		default: return 0;
	}
}

void mc8123_decrypt_0066(void)
{
	UINT8 *decrypted;
	UINT8 *rom = memory_region(REGION_CPU2);
	UINT8 *data_select = data_select_0066;
	UINT8 *opcode_select = opcode_select_0066;
	int A;
	decrypted = auto_malloc(0x50000);

	memory_set_opcode_base(1,decrypted);

	for (A = 0x0000;A < 0x8000;A++)
	{
		int tbl_num;
		UINT8 src = rom[A];

		/* pick the translation table from bits 7d57 of the address */
		tbl_num = (A & 7) + ((A & 0x10)>>1) + ((A & 0x40)>>2) + ((A & 0x100)>>3) + ((A & 0xc00)>>4) + ((A & 0x7000)>>4) ;

		/* decode the opcodes */
		decrypted[A] = decrypt(src,opcode_select[tbl_num],1);

		/* decode the data */
		rom[A] = decrypt(src,data_select[tbl_num],0);
	}

	/* copy the opcodes from the not encrypted part of the ROMs */
	for (A = 0x8000;A < 0x50000;A++)
		decrypted[A] = rom[A];
}
